<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistem Manajemen Buku - Tambah Buku Baru">
    <meta name="keywords" content="tambah buku, buku baru, manajemen, sistem informasi, perpustakaan">
    <meta name="author" content="Praktikum SIWEB">
    
    <title>Tambah Buku - Sistem Manajemen Buku</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/add-book.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-book-half"></i>
                BookManager
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house-fill"></i> Beranda
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="books.html">
                            <i class="bi bi-collection-fill"></i> Koleksi Buku
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="add-book.html">
                            <i class="bi bi-plus-circle-fill"></i> Tambah Buku
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main>
        <section id="form" class="form-section">
            <div class="container-fluid px-4">
                <div class="section-title mb-5">
                    <h2>Tambah Buku Baru</h2>
                    <p>Masukkan data buku yang ingin ditambahkan ke dalam sistem</p>
                </div>

                <div class="form-container">
                    <div class="success-message" id="successMessage">
                        <i class="bi bi-check-circle-fill"></i> Buku berhasil ditambahkan ke sistem! 
                        <a href="books.html" style="color: #fff; text-decoration: underline; font-weight: 700;">Lihat Koleksi Buku &rarr;</a>
                    </div>

                    <form id="bookForm" novalidate>
                        <!-- Judul Buku -->
                        <div class="form-group">
                            <label for="bookTitle">
                                <i class="bi bi-book-fill"></i> Judul Buku <span class="required-marker">*</span>
                            </label>
                            <input type="text" class="form-control" id="bookTitle" name="bookTitle" 
                                   placeholder="Masukkan judul buku" required>
                            <div class="error-message">Judul buku tidak boleh kosong</div>
                        </div>

                        <!-- Penulis dan Penerbit -->
                        <div class="form-row">
                            <!-- Penulis -->
                            <div class="form-group">
                                <label for="bookAuthor">
                                    <i class="bi bi-pen-fill"></i> Penulis <span class="required-marker">*</span>
                                </label>
                                <input type="text" class="form-control" id="bookAuthor" name="bookAuthor" 
                                       placeholder="Nama penulis" required>
                                <div class="error-message">Nama penulis tidak boleh kosong</div>
                            </div>

                            <!-- Penerbit -->
                            <div class="form-group">
                                <label for="bookPublisher">
                                    <i class="bi bi-bookmark-fill"></i> Penerbit <span class="required-marker">*</span>
                                </label>
                                <input type="text" class="form-control" id="bookPublisher" name="bookPublisher" 
                                       placeholder="Nama penerbit" required>
                                <div class="error-message">Nama penerbit tidak boleh kosong</div>
                            </div>
                        </div>

                        <!-- Tahun Terbit dan Kategori -->
                        <div class="form-row">
                            <!-- Tahun Terbit -->
                            <div class="form-group">
                                <label for="bookYear">
                                    <i class="bi bi-calendar-fill"></i> Tahun Terbit <span class="required-marker">*</span>
                                </label>
                                <input type="number" class="form-control" id="bookYear" name="bookYear" 
                                       placeholder="2024" min="1900" max="2100" required>
                                <div class="error-message">Tahun terbit harus berupa angka antara 1900-2100</div>
                            </div>

                            <!-- Kategori -->
                            <div class="form-group">
                                <label for="bookCategory">
                                    <i class="bi bi-collection-fill"></i> Kategori <span class="required-marker">*</span>
                                </label>
                                <select class="form-control" id="bookCategory" name="bookCategory" required>
                                    <option value="">-- Pilih Kategori --</option>
                                    <option value="Teknologi">Teknologi & Informatika</option>
                                    <option value="Fiksi">Fiksi & Sastra</option>
                                    <option value="Non-Fiksi">Non-Fiksi & Biografi</option>
                                    <option value="Bisnis">Bisnis & Ekonomi</option>
                                    <option value="Pendidikan">Pendidikan & Sains</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                                <div class="error-message">Silakan pilih kategori</div>
                            </div>
                        </div>

                        <!-- Cover Buku -->
                        <div class="form-group">
                            <label for="bookCover">
                                <i class="bi bi-image-fill"></i> Cover Buku
                            </label>
                            <div class="cover-upload-area" id="coverUploadArea">
                                <div class="cover-preview" id="coverPreview">
                                    <img id="coverPreviewImg" src="" alt="Preview Cover">
                                    <button type="button" class="cover-remove-btn" id="removeCover" title="Hapus Cover">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>
                                <div class="cover-placeholder" id="coverPlaceholder">
                                    <i class="bi bi-cloud-arrow-up-fill"></i>
                                    <p>Klik atau seret gambar cover ke sini</p>
                                    <small>Format: JPG, PNG, WEBP (Maks. 2MB)</small>
                                </div>
                                <input type="file" class="cover-input" id="bookCover" name="bookCover" 
                                       accept="image/jpeg,image/png,image/webp">
                            </div>
                        </div>

                        <!-- Deskripsi -->
                        <div class="form-group">
                            <label for="bookDescription">
                                <i class="bi bi-file-text-fill"></i> Deskripsi Buku <span class="required-marker">*</span>
                            </label>
                            <textarea class="form-control" id="bookDescription" name="bookDescription" 
                                      placeholder="Masukkan sinopsis atau deskripsi singkat tentang buku..." required></textarea>
                            <div class="error-message">Deskripsi buku tidak boleh kosong</div>
                        </div>

                        <!-- Jumlah Salinan dan ISBN -->
                        <div class="form-row">
                            <!-- Jumlah Salinan -->
                            <div class="form-group">
                                <label for="bookCopy">
                                    <i class="bi bi-stack"></i> Jumlah Salinan <span class="required-marker">*</span>
                                </label>
                                <input type="number" class="form-control" id="bookCopy" name="bookCopy" 
                                       placeholder="Jumlah salinan" min="1" max="1000" required>
                                <div class="error-message">Jumlah salinan harus angka positif</div>
                            </div>

                            <!-- ISBN -->
                            <div class="form-group">
                                <label for="bookISBN">
                                    <i class="bi bi-barcode"></i> ISBN
                                </label>
                                <input type="text" class="form-control" id="bookISBN" name="bookISBN" 
                                       placeholder="ISBN (opsional)">
                            </div>
                        </div>

                        <!-- Note -->
                        <div class="form-note">
                            <i class="bi bi-info-circle-fill"></i>
                            <small><strong>Catatan:</strong> Kolom yang ditandai dengan asterisk (*) wajib diisi. Dapatkan ISBN dari penerbit atau sumber terpercaya lainnya.</small>
                        </div>

                        <!-- Tombol Kirim -->
                        <button type="submit" class="form-button">
                            <i class="bi bi-check-lg"></i> Tambahkan Buku
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <!-- About Section -->
            <div class="footer-section">
                <h4>
                    <i class="bi bi-info-circle"></i> Tentang Kami
                </h4>
                <p>Sistem Manajemen Buku adalah platform digital yang dirancang untuk memudahkan pengelolaan koleksi buku di perpustakaan atau organisasi Anda.</p>
                <div class="footer-social">
                    <a href="#" title="Facebook" aria-label="Facebook">
                        <i class="bi bi-facebook"></i>
                    </a>
                    <a href="#" title="Twitter" aria-label="Twitter">
                        <i class="bi bi-twitter"></i>
                    </a>
                    <a href="#" title="Instagram" aria-label="Instagram">
                        <i class="bi bi-instagram"></i>
                    </a>
                    <a href="#" title="LinkedIn" aria-label="LinkedIn">
                        <i class="bi bi-linkedin"></i>
                    </a>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="footer-section">
                <h4>
                    <i class="bi bi-link-45deg"></i> Tautan Cepat
                </h4>
                <ul>
                    <li><a href="index.html">Beranda</a></li>
                    <li><a href="books.html">Koleksi Buku</a></li>
                    <li><a href="add-book.html">Tambah Buku</a></li>
                </ul>
            </div>

            <!-- Resources -->
            <div class="footer-section">
                <h4>
                    <i class="bi bi-resources"></i> Sumber Daya
                </h4>
                <ul>
                    <li><a href="#">Panduan Pengguna</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Kebijakan Privasi</a></li>
                    <li><a href="#">Syarat & Ketentuan</a></li>
                </ul>
            </div>

            <!-- Contact -->
            <div class="footer-section">
                <h4>
                    <i class="bi bi-telephone-fill"></i> Kontak Kami
                </h4>
                <ul class="footer-contact-list">
                    <li class="footer-contact-item">
                        <i class="bi bi-envelope-fill"></i> 
                        <a href="mailto:info@bookmanager.com">info@bookmanager.com</a>
                    </li>
                    <li class="footer-contact-item">
                        <i class="bi bi-telephone-fill"></i> 
                        <a href="tel:+62123456789">+62 (123) 456-789</a>
                    </li>
                    <li>
                        <i class="bi bi-geo-alt-fill"></i> 
                        Jl. Teknologi No. 123, Jakarta, Indonesia
                    </li>
                </ul>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <p>&copy;Sistem Manajemen Buku. Semua bisa membaca.</p>
            <p>Dikembangkan dengan <i class="bi bi-heart-fill heart-icon"></i> oleh Nick Bryan Andos Sianturi</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const bookForm = document.getElementById('bookForm');
        const successMessage = document.getElementById('successMessage');
        let coverBase64 = '';

        const coverUploadArea = document.getElementById('coverUploadArea');
        const coverInput = document.getElementById('bookCover');
        const coverPreview = document.getElementById('coverPreview');
        const coverPreviewImg = document.getElementById('coverPreviewImg');
        const coverPlaceholder = document.getElementById('coverPlaceholder');
        const removeCoverBtn = document.getElementById('removeCover');

        coverUploadArea.addEventListener('click', function(e) {
            if (e.target.closest('#removeCover')) return;
            coverInput.click();
        });

        coverInput.addEventListener('change', function(e) {
            handleCoverFile(e.target.files[0]);
        });

        // Drag & Drop
        coverUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });
        coverUploadArea.addEventListener('dragleave', function() {
            this.classList.remove('drag-over');
        });
        coverUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) handleCoverFile(file);
        });

        removeCoverBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            coverBase64 = '';
            coverInput.value = '';
            coverPreview.style.display = 'none';
            coverPlaceholder.style.display = 'flex';
        });

        function handleCoverFile(file) {
            if (!file) return;
            if (!['image/jpeg','image/png','image/webp'].includes(file.type)) {
                alert('Format file tidak didukung. Gunakan JPG, PNG, atau WEBP.');
                return;
            }
            if (file.size > 2 * 1024 * 1024) {
                alert('Ukuran file terlalu besar. Maksimal 2MB.');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                coverBase64 = e.target.result;
                coverPreviewImg.src = coverBase64;
                coverPreview.style.display = 'block';
                coverPlaceholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function validateForm() {
            let isValid = true;
            const fields = [
                { id: 'bookTitle', minLength: 3 },
                { id: 'bookAuthor', minLength: 2 },
                { id: 'bookPublisher', minLength: 2 },
                { id: 'bookYear', type: 'number', min: 1900, max: 2100 },
                { id: 'bookCategory', required: true },
                { id: 'bookDescription', minLength: 10 },
                { id: 'bookCopy', type: 'number', min: 1 }
            ];

            fields.forEach(field => {
                const input = document.getElementById(field.id);
                const formGroup = input.closest('.form-group');
                let valid = false;

                if (field.type === 'number') {
                    const value = parseInt(input.value);
                    valid = !isNaN(value) && value >= (field.min || -Infinity) && value <= (field.max || Infinity);
                } else if (field.id === 'bookCategory') {
                    valid = input.value !== '';
                } else {
                    valid = input.value.trim().length >= (field.minLength || 1);
                }

                if (!valid) {
                    formGroup.classList.add('error');
                    isValid = false;
                } else {
                    formGroup.classList.remove('error');
                }
            });

            return isValid;
        }

        bookForm.addEventListener('submit', function(e) {
            e.preventDefault();

            if (validateForm()) {
                // Build book object
                const newBook = {
                    id: Date.now(),
                    title: document.getElementById('bookTitle').value.trim(),
                    author: document.getElementById('bookAuthor').value.trim(),
                    publisher: document.getElementById('bookPublisher').value.trim(),
                    year: document.getElementById('bookYear').value,
                    category: document.getElementById('bookCategory').value,
                    description: document.getElementById('bookDescription').value.trim(),
                    copy: parseInt(document.getElementById('bookCopy').value),
                    isbn: document.getElementById('bookISBN').value.trim(),
                    cover: coverBase64,
                    status: 'Tersedia',
                    addedAt: new Date().toISOString()
                };

                // Save to localStorage
                const books = JSON.parse(localStorage.getItem('bookCollection') || '[]');
                books.push(newBook);
                localStorage.setItem('bookCollection', JSON.stringify(books));

                console.log('Data Buku yang Ditambahkan:', newBook);

                // Show Success Message
                successMessage.classList.add('show');

                // Reset Form & cover preview
                bookForm.reset();
                coverBase64 = '';
                coverPreview.style.display = 'none';
                coverPlaceholder.style.display = 'flex';

                // Hide Success Message after 5 seconds
                setTimeout(() => {
                    successMessage.classList.remove('show');
                }, 5000);

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        const inputs = bookForm.querySelectorAll('input:not(#bookCover), textarea, select');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                const formGroup = this.closest('.form-group');
                let valid = true;

                if (this.id === 'bookYear' || this.id === 'bookCopy') {
                    const value = parseInt(this.value);
                    if (this.id === 'bookYear') {
                        valid = !isNaN(value) && value >= 1900 && value <= 2100;
                    } else {
                        valid = !isNaN(value) && value >= 1;
                    }
                } else if (this.id === 'bookCategory') {
                    valid = this.value !== '';
                } else {
                    valid = this.value.trim().length > 0;
                }

                if (!valid) {
                    formGroup.classList.add('error');
                } else {
                    formGroup.classList.remove('error');
                }
            });
        });

        function updateActiveNavLink() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                const href = link.getAttribute('href');
                if (href === 'add-book.html' || href === window.location.pathname.split('/').pop()) {
                    link.classList.add('active');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', updateActiveNavLink);

        console.log('%cSelamat datang di Tambah Buku!', 'color: #3498db; font-size: 18px; font-weight: bold;');
        console.log('%cVersi√≥n: 1.0.0', 'color: #27ae60; font-size: 14px;');
    </script>
</body>
</html>
